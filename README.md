# AIファミリー・シミュレーター「未来の家族を体験」

## 📋 プロダクト概要

AIファミリー・シミュレーターは、Gemini 2.5 Flash Live APIを活用した自然な対話システムを通じて、ユーザーの理想の家族像を生成し、リアルタイムで音声・テキスト対話ができるWebアプリケーションです。

**目的**: 結婚や出産に対する心理的な不安を軽減し、「子どもを持つ未来」をポジティブに体験してもらうこと

### 🔧 技術的特徴
- **Gemini Live API**: リアルタイム音声・テキスト対話
- **Firebase統合**: 認証・ストレージ・セッション管理
- **WebSocket通信**: 低遅延のリアルタイム通信
- **Cloud Run**: サーバーレスでスケーラブルなデプロイ

---

## 🎯 背景と課題

### 社会課題
- **少子化の要因**: 出産・育児に対する不安が大きな要因の一つ
- **若年層の心理**: 「自分に子育ては無理」「生活が苦しくなる」という先入観
- **解決の可能性**: 未来の家族像を具体的にイメージできれば、ポジティブな動機付けになる

### ターゲットユーザー

#### プライマリーユーザー
- **結婚・出産を考えている20〜30代の男女**
- **出産・子育てに不安を持つカップル**

#### セカンダリーユーザー
- **行政やNPOなど、少子化対策や結婚支援の施策に関心がある団体**

---

## 🚀 機能要件

### 主要機能

#### 1. AIファミリー生成
- ユーザーの希望や理想に基づいてAIが家族を生成
- パーソナライズされた家族メンバーの性格・特徴設定

#### 2. リアルタイム対話
- **音声対話**: WebSocketによるリアルタイム音声通信
- **テキスト対話**: チャット形式でのメッセージ交換
- **マルチモーダル**: 音声とテキストの自由な切り替え

#### 3. セッション管理
- Firebaseによる永続的なセッション保存
- 過去の会話履歴の参照機能

### 3. コンテンツ生成システム

#### 生成コンテンツ
1. **未来の家族ストーリー**
   - 日常のストーリーをストリーム表示
   - イラストと背景にストーリーを組み合わせ

2. **家族旅行イラスト**
   - 会話内容をインプットにしたイラスト生成
   - 高品質な家族旅行画像

3. **子どもからの手紙**
   - 毎回異なる子どもの落書き付き手紙画像を生成
   - 手紙の文章と落書きを組み合わせた画像を動的生成
   - 子どもの年齢に応じた落書きスタイル（幼児のクレヨン画、小学生の鉛筆画など）

4. **動画コンテンツ**
   - ストーリーをインプットにした動画表示
   - ストーリー読み終了後、イラストが動き出す
   - 音声付き（可能な範囲で）

---

## 🎬 ユースケース（デモ想定）

### 1. ヘーラーエージェント対話フェーズ
1. ユーザーがアプリにアクセス
2. 「ヘーラー（Hera）」エージェントが音声で案内
3. 自然な対話でユーザー情報を収集（年齢、収入、ライフスタイル等）
4. 収集した情報を一時ファイルに保存
5. 音声入力で自然な情報収集

### 2. 家族マルチエージェント対話フェーズ
1. エージェントが高度な対話でユーザー情報を収集
2. Gemini Proを使用した自然な会話処理
3. 音声入力・出力による直感的な対話体験
4. リアルタイムでの情報抽出と分析

### 3. コンテンツ生成フェーズ
1. 収集した情報を基に家族の未来ストーリーを生成
2. 高品質な家族画像の生成
3. 音声付き動画コンテンツの作成
4. 個別化された家族体験の提供

### 4. コンテンツ表示フェーズ
1. イラストとストーリーを組み合わせて表示
2. 動画コンテンツの生成・再生
3. 子どもからの手紙の表示（毎回異なる落書き付き画像を動的生成）

---

## 🏗️ 技術要件

### フロントエンド
- **Framework**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **認証**: Firebase Authentication
- **リアルタイム通信**: WebSocket

### バックエンド
- **API サーバー**: Flask + CORS対応
- **AI**: Gemini 2.5 Flash Live API
- **音声処理**: Gemini Live APIの内蔵音声機能
- **セッション管理**: Firebase Storage
- **認証**: Firebase Admin SDK

### インフラ
- **ホスティング**: Google Cloud Run (サーバーレス)
- **CI/CD**: Cloud Build
- **ストレージ**: Firebase Storage
- **認証**: Firebase Authentication

---

## 📊 成功指標

### 定量的指標
- **ユーザーエンゲージメント**: セッション時間、ページ滞在時間
- **コンテンツ生成数**: 生成されたストーリー、イラスト、手紙の数
- **ユーザー満足度**: アンケート結果、評価スコア

### 定性的指標
- **心理的変化**: 出産・育児に対する不安の軽減
- **未来イメージ**: 家族を持つ未来へのポジティブなイメージ
- **社会的影響**: 少子化対策への貢献度

---

## 🚀 セットアップと実行

### 必要要件
- Node.js 18+
- Python 3.11+
- Firebase プロジェクト
- Google Cloud プロジェクト
- Gemini API キー

### ⚙️ ローカル開発環境

#### Backend
```bash
cd backend
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 環境変数設定
cp .env.example .env
# .envファイルを編集

# サーバー起動
python app.py
# http://localhost:8080
```

#### Frontend
```bash
cd frontend
npm install

# 環境変数設定
cp .env.example .env.local
# .env.localファイルを編集

# 開発サーバー起動
npm run dev
# http://localhost:3000
```

### 🚀 デプロイ (Cloud Run)

```bash
# Backend デプロイ
cd infra
./deploy-with-cloudbuild.sh

# Frontend デプロイ
./deploy-frontend-with-version.sh
```

### 利用可能なAPI

#### REST API エンドポイント

1. **セッション管理**
   - `POST /api/sessions` - セッション作成
   - `GET /api/sessions/{id}/status` - セッション状態取得
   - `POST /api/sessions/{id}/ephemeral-token` - Ephemeral Token取得
   - `POST /api/sessions/{id}/complete` - セッション完了

2. **対話機能**
   - `POST /api/sessions/{id}/messages` - メッセージ送信
   - WebSocket接続 - リアルタイム音声・テキスト対話

3. **システム**
   - `GET /api/health` - ヘルスチェック
   - `GET /api/version` - バージョン情報

### API使用例

```bash
# 1. セッション作成
curl -X POST http://localhost:8080/api/sessions

# 2. メッセージ送信
curl -X POST http://localhost:8080/api/sessions/{session_id}/messages \
  -H "Content-Type: application/json" \
  -d '{"message": "こんにちは、33歳のエンジニアです"}'

# 3. セッション状態確認
curl http://localhost:8080/api/sessions/{session_id}/status
```

詳しくは [backend/README.md](backend/README.md) をご覧ください。

---

## 📝 備考

- 本プロダクトは社会的意義の高いプロジェクトとして、技術的な実現可能性と社会的インパクトの両方を重視
- ユーザーのプライバシー保護とデータセキュリティを最優先
- 生成AIの倫理的使用とコンテンツの適切性を確保
