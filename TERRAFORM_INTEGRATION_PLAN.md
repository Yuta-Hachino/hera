# TerraformÁµ±ÂêàË®àÁîª

**‰ΩúÊàêÊó•**: 2025-10-28
**ÂØæË±°**: Hera„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ„Ç§„É≥„Éï„É©„ÇíTerraform„Åß„Ç≥„Éº„ÉâÂåñ

---

## üìã ÁõÆÊ¨°

1. [Terraform„Å®„ÅØ](#terraform„Å®„ÅØ)
2. [ÈÅ©Áî®„Åô„Çã„É™„ÇΩ„Éº„Çπ](#ÈÅ©Áî®„Åô„Çã„É™„ÇΩ„Éº„Çπ)
3. [„Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÊàê](#„Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÊàê)
4. [ÂÆüË£Ö‰æã](#ÂÆüË£Ö‰æã)
5. [Áí∞Â¢ÉÂà•ÁÆ°ÁêÜ](#Áí∞Â¢ÉÂà•ÁÆ°ÁêÜ)
6. [„Éá„Éó„É≠„Ç§„Éï„É≠„Éº](#„Éá„Éó„É≠„Ç§„Éï„É≠„Éº)
7. [„É°„É™„ÉÉ„Éà„Éª„Éá„É°„É™„ÉÉ„Éà](#„É°„É™„ÉÉ„Éà„Éá„É°„É™„ÉÉ„Éà)

---

## 1. Terraform„Å®„ÅØ

### Infrastructure as Code (IaC)

Terraform„ÅØ„ÄÅ„Ç§„É≥„Éï„É©„Çí„Ç≥„Éº„Éâ„ÅßÂÆöÁæ©„ÉªÁÆ°ÁêÜ„Åô„Çã„ÉÑ„Éº„É´„Åß„Åô„ÄÇ

```hcl
# „Ç≥„Éº„Éâ„Åß„Ç§„É≥„Éï„É©„ÇíÂÆöÁæ©
resource "aws_ecs_service" "backend" {
  name            = "hera-backend"
  cluster         = aws_ecs_cluster.main.id
  task_definition = aws_ecs_task_definition.backend.arn
  desired_count   = 2
}
```

### ‰∏ª„Å™ÁâπÂæ¥

‚úÖ **ÂÆ£Ë®ÄÁöÑ„Å™Ë®òËø∞**: „Äå„Å©„ÅÜ„Åô„Çã„Åã„Äç„Åß„ÅØ„Å™„Åè„Äå‰Ωï„Çí‰Ωú„Çã„Åã„Äç„ÇíË®òËø∞
‚úÖ **ÂÜ™Á≠âÊÄß**: ‰ΩïÂ∫¶ÂÆüË°å„Åó„Å¶„ÇÇÂêå„ÅòÁµêÊûú
‚úÖ **Áä∂ÊÖãÁÆ°ÁêÜ**: ÁèæÂú®„ÅÆ„Ç§„É≥„Éï„É©Áä∂ÊÖã„ÇíËøΩË∑°
‚úÖ **‰æùÂ≠òÈñ¢‰øÇËß£Ê±∫**: „É™„ÇΩ„Éº„ÇπÈñì„ÅÆ‰æùÂ≠òÈñ¢‰øÇ„ÇíËá™ÂãïÁÆ°ÁêÜ
‚úÖ **„Éû„É´„ÉÅ„ÇØ„É©„Ç¶„Éâ**: AWS„ÄÅGCP„ÄÅAzure„ÄÅSupabase„Å™„Å©Áµ±‰∏ÄÁöÑ„Å´ÁÆ°ÁêÜ

---

## 2. ÈÅ©Áî®„Åô„Çã„É™„ÇΩ„Éº„Çπ

### 2.1 Supabase„É™„ÇΩ„Éº„Çπ

```
- „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„ÉûÔºà„ÉÜ„Éº„Éñ„É´„ÄÅ„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÔºâ
- Storage „Éê„Ç±„ÉÉ„Éà
- Row Level Security (RLS) „Éù„É™„Ç∑„Éº
- „Éá„Éº„Çø„Éô„Éº„ÇπÈñ¢Êï∞„Éª„Éà„É™„Ç¨„Éº
- APIË®≠ÂÆö
```

### 2.2 „ÇØ„É©„Ç¶„Éâ„Ç§„É≥„Éï„É©ÔºàAWS‰æãÔºâ

```
- ECS „ÇØ„É©„Çπ„Çø„Éº
- ECS „Çø„Çπ„ÇØÂÆöÁæ©ÔºàBackend„ÄÅFrontend„ÄÅADKÔºâ
- Application Load Balancer (ALB)
- VPC„ÄÅ„Çµ„Éñ„Éç„ÉÉ„Éà„ÄÅ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç∞„É´„Éº„Éó
- IAM „É≠„Éº„É´„Éª„Éù„É™„Ç∑„Éº
- CloudWatch „É≠„Ç∞
- Route53 DNSË®≠ÂÆö
- ACM Ë®ºÊòéÊõ∏
```

### 2.3 „Åù„ÅÆ‰ªñ

```
- Áí∞Â¢ÉÂ§âÊï∞ÔºàAWS Systems Manager Parameter StoreÔºâ
- „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÁÆ°ÁêÜÔºàAWS Secrets ManagerÔºâ
- „É¢„Éã„Çø„É™„É≥„Ç∞ÔºàCloudWatch AlarmsÔºâ
```

---

## 3. „Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÊàê

```
hera/
‚îú‚îÄ‚îÄ terraform/
‚îÇ   ‚îú‚îÄ‚îÄ modules/                    # ÂÜçÂà©Áî®ÂèØËÉΩ„Å™„É¢„Ç∏„É•„Éº„É´
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase/              # SupabaseÊßãÊàê
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecs/                   # ECSÊßãÊàê
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ networking/            # VPC„Éª„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ environments/              # Áí∞Â¢ÉÂà•Ë®≠ÂÆö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backend.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backend.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prod/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ backend.tf
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ providers.tf               # „Éó„É≠„Éê„Ç§„ÉÄ„ÉºË®≠ÂÆö
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf               # ÂÖ±ÈÄöÂ§âÊï∞
‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf                 # Âá∫ÂäõÂÄ§
‚îÇ
‚îú‚îÄ‚îÄ backend/
‚îú‚îÄ‚îÄ frontend/
‚îî‚îÄ‚îÄ adk/
```

---

## 4. ÂÆüË£Ö‰æã

### 4.1 „Éó„É≠„Éê„Ç§„ÉÄ„ÉºË®≠ÂÆö

**terraform/providers.tf**

```hcl
terraform {
  required_version = ">= 1.6"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    supabase = {
      source  = "supabase/supabase"
      version = "~> 1.0"
    }
  }

  # Áä∂ÊÖãÁÆ°ÁêÜ„ÇíS3„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Åß
  backend "s3" {
    bucket         = "hera-terraform-state"
    key            = "terraform.tfstate"
    region         = "ap-northeast-1"
    encrypt        = true
    dynamodb_table = "terraform-state-lock"
  }
}

provider "aws" {
  region = var.aws_region
}

provider "supabase" {
  access_token = var.supabase_access_token
  project_id   = var.supabase_project_id
}
```

### 4.2 Supabase„É¢„Ç∏„É•„Éº„É´

**terraform/modules/supabase/main.tf**

```hcl
# Supabase„Éó„É≠„Ç∏„Çß„ÇØ„Éà
resource "supabase_project" "main" {
  name           = var.project_name
  organization_id = var.organization_id
  database_password = var.database_password
  region         = var.region
  plan           = var.plan  # "free" or "pro"
}

# Storage „Éê„Ç±„ÉÉ„Éà
resource "supabase_storage_bucket" "session_images" {
  name     = "session-images"
  public   = true
  project_id = supabase_project.main.id

  file_size_limit = 5242880  # 5MB
  allowed_mime_types = [
    "image/png",
    "image/jpeg",
    "image/webp"
  ]
}

# „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû
resource "supabase_sql" "schema" {
  project_id = supabase_project.main.id

  query = file("${path.module}/schema.sql")
}

# RLS„Éù„É™„Ç∑„Éº
resource "supabase_sql" "rls_policies" {
  project_id = supabase_project.main.id
  depends_on = [supabase_sql.schema]

  query = file("${path.module}/rls_policies.sql")
}
```

**terraform/modules/supabase/schema.sql**

```sql
-- sessions „ÉÜ„Éº„Éñ„É´
CREATE TABLE IF NOT EXISTS sessions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    session_id TEXT UNIQUE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    status TEXT DEFAULT 'active'
);

CREATE INDEX idx_sessions_session_id ON sessions(session_id);
CREATE INDEX idx_sessions_created_at ON sessions(created_at);

-- user_profiles „ÉÜ„Éº„Éñ„É´
CREATE TABLE IF NOT EXISTS user_profiles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    session_id TEXT NOT NULL REFERENCES sessions(session_id) ON DELETE CASCADE,
    name TEXT,
    age INTEGER,
    partner_name TEXT,
    hobbies JSONB DEFAULT '[]',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(session_id)
);

-- ‰ª•‰∏ã„ÄÅ‰ªñ„ÅÆ„ÉÜ„Éº„Éñ„É´ÂÆöÁæ©...
```

**terraform/modules/supabase/rls_policies.sql**

```sql
-- RLS„ÇíÊúâÂäπÂåñ
ALTER TABLE sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE conversation_history ENABLE ROW LEVEL SECURITY;

-- „Éù„É™„Ç∑„Éº: ÂÖ®Âì°„ÅåËá™ÂàÜ„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíË™≠„ÅøÂèñ„ÇäÂèØËÉΩ
CREATE POLICY "Users can read own sessions"
ON sessions FOR SELECT
USING (true);

CREATE POLICY "Users can insert own sessions"
ON sessions FOR INSERT
WITH CHECK (true);

-- „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç°„Ç§„É´„ÅÆ„Éù„É™„Ç∑„Éº
CREATE POLICY "Users can read own profiles"
ON user_profiles FOR SELECT
USING (true);

CREATE POLICY "Users can update own profiles"
ON user_profiles FOR UPDATE
USING (true);
```

### 4.3 ECS„É¢„Ç∏„É•„Éº„É´

**terraform/modules/ecs/main.tf**

```hcl
# ECS „ÇØ„É©„Çπ„Çø„Éº
resource "aws_ecs_cluster" "main" {
  name = "${var.project_name}-cluster"

  setting {
    name  = "containerInsights"
    value = "enabled"
  }
}

# Backend „Çø„Çπ„ÇØÂÆöÁæ©
resource "aws_ecs_task_definition" "backend" {
  family                   = "${var.project_name}-backend"
  network_mode             = "awsvpc"
  requires_compatibilities = ["FARGATE"]
  cpu                      = var.backend_cpu
  memory                   = var.backend_memory
  execution_role_arn       = aws_iam_role.ecs_execution.arn
  task_role_arn            = aws_iam_role.ecs_task.arn

  container_definitions = jsonencode([
    {
      name  = "backend"
      image = "${var.ecr_repository_url}:backend-${var.image_tag}"

      portMappings = [
        {
          containerPort = 8080
          protocol      = "tcp"
        }
      ]

      environment = [
        {
          name  = "SUPABASE_URL"
          value = var.supabase_url
        },
        {
          name  = "STORAGE_MODE"
          value = "supabase"
        }
      ]

      secrets = [
        {
          name      = "GEMINI_API_KEY"
          valueFrom = aws_secretsmanager_secret.gemini_api_key.arn
        },
        {
          name      = "SUPABASE_KEY"
          valueFrom = aws_secretsmanager_secret.supabase_key.arn
        }
      ]

      logConfiguration = {
        logDriver = "awslogs"
        options = {
          "awslogs-group"         = aws_cloudwatch_log_group.backend.name
          "awslogs-region"        = var.aws_region
          "awslogs-stream-prefix" = "backend"
        }
      }
    }
  ])
}

# Backend „Çµ„Éº„Éì„Çπ
resource "aws_ecs_service" "backend" {
  name            = "${var.project_name}-backend"
  cluster         = aws_ecs_cluster.main.id
  task_definition = aws_ecs_task_definition.backend.arn
  desired_count   = var.backend_desired_count
  launch_type     = "FARGATE"

  network_configuration {
    subnets          = var.private_subnet_ids
    security_groups  = [aws_security_group.backend.id]
    assign_public_ip = false
  }

  load_balancer {
    target_group_arn = aws_lb_target_group.backend.arn
    container_name   = "backend"
    container_port   = 8080
  }

  depends_on = [aws_lb_listener.backend]
}

# Application Load Balancer
resource "aws_lb" "main" {
  name               = "${var.project_name}-alb"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb.id]
  subnets            = var.public_subnet_ids

  enable_deletion_protection = var.environment == "prod" ? true : false
}

# Target Group
resource "aws_lb_target_group" "backend" {
  name        = "${var.project_name}-backend"
  port        = 8080
  protocol    = "HTTP"
  vpc_id      = var.vpc_id
  target_type = "ip"

  health_check {
    path                = "/health"
    healthy_threshold   = 2
    unhealthy_threshold = 10
    timeout             = 60
    interval            = 300
    matcher             = "200"
  }
}

# Listener
resource "aws_lb_listener" "backend" {
  load_balancer_arn = aws_lb.main.arn
  port              = "443"
  protocol          = "HTTPS"
  ssl_policy        = "ELBSecurityPolicy-TLS13-1-2-2021-06"
  certificate_arn   = aws_acm_certificate.main.arn

  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.backend.arn
  }
}
```

### 4.4 „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„É¢„Ç∏„É•„Éº„É´

**terraform/modules/networking/main.tf**

```hcl
# VPC
resource "aws_vpc" "main" {
  cidr_block           = var.vpc_cidr
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "${var.project_name}-vpc"
  }
}

# Public Subnets
resource "aws_subnet" "public" {
  count             = length(var.availability_zones)
  vpc_id            = aws_vpc.main.id
  cidr_block        = cidrsubnet(var.vpc_cidr, 8, count.index)
  availability_zone = var.availability_zones[count.index]

  map_public_ip_on_launch = true

  tags = {
    Name = "${var.project_name}-public-${count.index + 1}"
  }
}

# Private Subnets
resource "aws_subnet" "private" {
  count             = length(var.availability_zones)
  vpc_id            = aws_vpc.main.id
  cidr_block        = cidrsubnet(var.vpc_cidr, 8, count.index + 10)
  availability_zone = var.availability_zones[count.index]

  tags = {
    Name = "${var.project_name}-private-${count.index + 1}"
  }
}

# Internet Gateway
resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = "${var.project_name}-igw"
  }
}

# NAT Gateway
resource "aws_eip" "nat" {
  count  = length(var.availability_zones)
  domain = "vpc"
}

resource "aws_nat_gateway" "main" {
  count         = length(var.availability_zones)
  allocation_id = aws_eip.nat[count.index].id
  subnet_id     = aws_subnet.public[count.index].id

  tags = {
    Name = "${var.project_name}-nat-${count.index + 1}"
  }
}

# Route Tables
resource "aws_route_table" "public" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.main.id
  }

  tags = {
    Name = "${var.project_name}-public"
  }
}

resource "aws_route_table" "private" {
  count  = length(var.availability_zones)
  vpc_id = aws_vpc.main.id

  route {
    cidr_block     = "0.0.0.0/0"
    nat_gateway_id = aws_nat_gateway.main[count.index].id
  }

  tags = {
    Name = "${var.project_name}-private-${count.index + 1}"
  }
}
```

---

## 5. Áí∞Â¢ÉÂà•ÁÆ°ÁêÜ

### 5.1 ÈñãÁô∫Áí∞Â¢É

**terraform/environments/dev/main.tf**

```hcl
module "networking" {
  source = "../../modules/networking"

  project_name       = "hera-dev"
  vpc_cidr           = "10.0.0.0/16"
  availability_zones = ["ap-northeast-1a", "ap-northeast-1c"]
  environment        = "dev"
}

module "supabase" {
  source = "../../modules/supabase"

  project_name      = "hera-dev"
  organization_id   = var.supabase_org_id
  database_password = var.supabase_db_password
  region            = "ap-northeast-1"
  plan              = "free"
}

module "ecs" {
  source = "../../modules/ecs"

  project_name           = "hera-dev"
  environment            = "dev"
  vpc_id                 = module.networking.vpc_id
  public_subnet_ids      = module.networking.public_subnet_ids
  private_subnet_ids     = module.networking.private_subnet_ids

  backend_desired_count  = 1  # ÈñãÁô∫Áí∞Â¢É„ÅØ1Âè∞
  backend_cpu            = "256"
  backend_memory         = "512"

  supabase_url           = module.supabase.api_url
  ecr_repository_url     = var.ecr_repository_url
  image_tag              = "latest"
}
```

**terraform/environments/dev/terraform.tfvars**

```hcl
aws_region          = "ap-northeast-1"
supabase_org_id     = "your-org-id"
ecr_repository_url  = "123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/hera"
```

### 5.2 Êú¨Áï™Áí∞Â¢É

**terraform/environments/prod/main.tf**

```hcl
module "networking" {
  source = "../../modules/networking"

  project_name       = "hera-prod"
  vpc_cidr           = "10.1.0.0/16"
  availability_zones = ["ap-northeast-1a", "ap-northeast-1c", "ap-northeast-1d"]
  environment        = "prod"
}

module "supabase" {
  source = "../../modules/supabase"

  project_name      = "hera-prod"
  organization_id   = var.supabase_org_id
  database_password = var.supabase_db_password
  region            = "ap-northeast-1"
  plan              = "pro"  # Êú¨Áï™„ÅØPro„Éó„É©„É≥
}

module "ecs" {
  source = "../../modules/ecs"

  project_name           = "hera-prod"
  environment            = "prod"
  vpc_id                 = module.networking.vpc_id
  public_subnet_ids      = module.networking.public_subnet_ids
  private_subnet_ids     = module.networking.private_subnet_ids

  backend_desired_count  = 3  # Êú¨Áï™„ÅØ3Âè∞ÔºàHigh AvailabilityÔºâ
  backend_cpu            = "1024"
  backend_memory         = "2048"

  supabase_url           = module.supabase.api_url
  ecr_repository_url     = var.ecr_repository_url
  image_tag              = var.image_tag  # Êú¨Áï™„ÅØ„Çø„Ç∞ÊåáÂÆö
}
```

---

## 6. „Éá„Éó„É≠„Ç§„Éï„É≠„Éº

### 6.1 ÂàùÂõû„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

```bash
# Terraform„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´
brew install terraform  # macOS
# „Åæ„Åü„ÅØ
wget https://releases.hashicorp.com/terraform/1.6.0/terraform_1.6.0_linux_amd64.zip

# „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÁßªÂãï
cd hera/terraform/environments/dev

# ÂàùÊúüÂåñ
terraform init

# „Éó„É©„É≥Á¢∫Ë™ç
terraform plan

# ÈÅ©Áî®
terraform apply
```

### 6.2 CI/CD„Éë„Ç§„Éó„É©„Ç§„É≥

**GitHub Actions‰æã (.github/workflows/terraform.yml)**

```yaml
name: Terraform

on:
  push:
    branches:
      - main
    paths:
      - 'terraform/**'
  pull_request:
    paths:
      - 'terraform/**'

jobs:
  terraform:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.6.0

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-1

      - name: Terraform Init
        working-directory: terraform/environments/dev
        run: terraform init

      - name: Terraform Plan
        working-directory: terraform/environments/dev
        run: terraform plan -out=tfplan

      - name: Terraform Apply
        if: github.ref == 'refs/heads/main'
        working-directory: terraform/environments/dev
        run: terraform apply -auto-approve tfplan
```

### 6.3 ÈÄöÂ∏∏„ÅÆÈÅãÁî®

```bash
# ÈñãÁô∫Áí∞Â¢É„ÅÆÊõ¥Êñ∞
cd terraform/environments/dev
terraform plan
terraform apply

# Êú¨Áï™Áí∞Â¢É„ÅÆÊõ¥Êñ∞ÔºàÊâøË™ç„Éó„É≠„Çª„Çπ‰ªò„ÅçÔºâ
cd terraform/environments/prod
terraform plan -out=prod.tfplan
# „É¨„Éì„É•„ÉºÂæå
terraform apply prod.tfplan

# ÁâπÂÆö„ÅÆ„É™„ÇΩ„Éº„Çπ„ÅÆ„ÅøÊõ¥Êñ∞
terraform apply -target=module.ecs.aws_ecs_service.backend

# „É™„ÇΩ„Éº„Çπ„ÅÆÂâäÈô§ÔºàÁí∞Â¢ÉÂÖ®‰ΩìÔºâ
terraform destroy  # Ê≥®ÊÑè: Êú¨Áï™„Åß„ÅØ‰ΩøÁî®Á¶ÅÊ≠¢
```

---

## 7. „É°„É™„ÉÉ„Éà„Éª„Éá„É°„É™„ÉÉ„Éà

### „É°„É™„ÉÉ„Éà ‚úÖ

#### 1. **„Ç≥„Éº„Éâ„Å´„Çà„ÇãÁÆ°ÁêÜ**
```hcl
# „Ç§„É≥„Éï„É©„ÅÆË®≠ÂÆö„ÅåÊòéÁ¢∫
resource "aws_ecs_service" "backend" {
  desired_count = 3  # Âè∞Êï∞„ÇíÂ§âÊõ¥„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„Åì„Åì„ÇíÂ§âÊõ¥
}
```

#### 2. **„Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ**
```bash
$ git log terraform/
commit abc123 Update backend task count to 3
commit def456 Add staging environment
commit ghi789 Initial Terraform setup
```

#### 3. **Â§âÊõ¥„ÅÆÂèØË¶ñÂåñ**
```bash
$ terraform plan
  ~ update in-place
  - destroy
  + create

Plan: 1 to add, 2 to change, 0 to destroy.
```

#### 4. **Áí∞Â¢É„ÅÆÂÜçÁèæ**
```bash
# ÈñãÁô∫Áí∞Â¢É„Çí10Áßí„ÅßÂÜçÊßãÁØâ
terraform destroy -auto-approve
terraform apply -auto-approve
```

#### 5. **„Éâ„É™„Éï„ÉàÊ§úÂá∫**
```bash
# „Ç≥„É≥„ÇΩ„Éº„É´„ÅßÊâãÂãïÂ§âÊõ¥„Åó„ÅüÂ†¥Âêà„Å´Ê§úÂá∫
$ terraform plan
Note: Objects have changed outside of Terraform
```

#### 6. **„Éâ„Ç≠„É•„É°„É≥„ÉàÂåñ**
- „Ç≥„Éº„Éâ„Åù„ÅÆ„ÇÇ„ÅÆ„Åå„Éâ„Ç≠„É•„É°„É≥„Éà
- ÊßãÊàê„ÅåÊòéÁ¢∫
- „É¨„Éì„É•„Éº„ÅåÂÆπÊòì

### „Éá„É°„É™„ÉÉ„Éà ‚ö†Ô∏è

#### 1. **Â≠¶Áøí„Ç≥„Çπ„Éà**
- HCLÔºàHashiCorp Configuration LanguageÔºâ„ÅÆÂ≠¶Áøí„ÅåÂøÖË¶Å
- ÂêÑ„Éó„É≠„Éê„Ç§„ÉÄ„Éº„ÅÆ„É™„ÇΩ„Éº„ÇπÂÆöÁæ©„ÇíÁêÜËß£„Åô„ÇãÂøÖË¶Å

#### 2. **ÂàùÊúü„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„ÅÆÊâãÈñì**
- „É¢„Ç∏„É•„Éº„É´Ë®≠Ë®à
- Áä∂ÊÖãÁÆ°ÁêÜ„ÅÆË®≠ÂÆö
- CI/CDÁµ±Âêà

#### 3. **Áä∂ÊÖãÁÆ°ÁêÜ„ÅÆË§áÈõë„Åï**
- terraform.tfstate „ÅÆÁÆ°ÁêÜ
- „É≠„ÉÉ„ÇØÊ©üÊßã„ÅåÂøÖË¶ÅÔºàDynamoDBÔºâ
- „ÉÅ„Éº„É†ÂçîÊ•≠ÊôÇ„ÅÆÁ´∂Âêà

#### 4. **ÂÖ®„Å¶„Åå„Ç≥„Éº„ÉâÂåñ„Åß„Åç„Çã„Çè„Åë„Åß„ÅØ„Å™„ÅÑ**
- ‰∏ÄÈÉ®„ÅÆÊâãÂãïÊìç‰Ωú„ÅåÂøÖË¶Å„Å™Â†¥Âêà„Åå„ÅÇ„Çã
- „Éó„É≠„Éê„Ç§„ÉÄ„Éº„ÅåÂØæÂøú„Åó„Å¶„ÅÑ„Å™„ÅÑ„É™„ÇΩ„Éº„Çπ„ÇÇ„ÅÇ„Çã

---

## 8. „Ç≥„Çπ„ÉàÊØîËºÉ

### ÊâãÂãïÁÆ°ÁêÜÔºàÁèæÁä∂Ôºâ

| È†ÖÁõÆ | „Ç≥„Çπ„Éà |
|------|--------|
| ‰∫∫‰ª∂Ë≤ªÔºàÁí∞Â¢ÉÊßãÁØâÔºâ | 8ÊôÇÈñì √ó ‰∫∫‰ª∂Ë≤ª |
| ‰∫∫‰ª∂Ë≤ªÔºàÈÅãÁî®„ÉªÂ§âÊõ¥Ôºâ | 2ÊôÇÈñì/Êúà √ó ‰∫∫‰ª∂Ë≤ª |
| **„Éü„Çπ„ÅÆ„É™„Çπ„ÇØ** | È´ò„ÅÑ |

### TerraformÁÆ°ÁêÜ

| È†ÖÁõÆ | „Ç≥„Çπ„Éà |
|------|--------|
| ÂàùÊúü„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó | 16ÊôÇÈñì √ó ‰∫∫‰ª∂Ë≤ªÔºàÂàùÂõû„ÅÆ„ÅøÔºâ |
| ‰∫∫‰ª∂Ë≤ªÔºàÈÅãÁî®„ÉªÂ§âÊõ¥Ôºâ | 0.5ÊôÇÈñì/Êúà √ó ‰∫∫‰ª∂Ë≤ª |
| Terraform CloudÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ | $20/ÊúàÔºà„ÉÅ„Éº„É†ÂçîÊ•≠Ôºâ |
| **„Éü„Çπ„ÅÆ„É™„Çπ„ÇØ** | ‰Ωé„ÅÑ |

**ÁµêË´ñ**: ÂàùÊúüÊäïË≥á„ÅØÂøÖË¶Å„Å†„Åå„ÄÅÈï∑ÊúüÁöÑ„Å´„ÅØÂ§ßÂπÖ„Å´„Ç≥„Çπ„ÉàÂâäÊ∏õ

---

## 9. Êé®Â•®ÊßãÊàê

### Option A: Terraform + Supabase + AWS ECSÔºàÊé®Â•®Ôºâ

```
‚úÖ ÂÆåÂÖ®„Å™Infrastructure as Code
‚úÖ SupabaseÔºàDB + StorageÔºâ„ÅØTerraform„ÅßÁÆ°ÁêÜ
‚úÖ ECSÔºà„Ç≥„É≥„ÉÜ„ÉäÔºâ„ÇÇTerraform„ÅßÁÆ°ÁêÜ
‚úÖ Áí∞Â¢É„ÅÆÂÆåÂÖ®„Å™ÂÜçÁèæÊÄß
‚úÖ CI/CD„Å®„ÅÆÁµ±Âêà
```

**Êé®ÂÆö„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊôÇÈñì**: 16-20ÊôÇÈñì
**ÊúàÈ°ç„Ç≥„Çπ„Éà**: Supabase Pro $25 + AWS ECS $50 = **$75/Êúà**

### Option B: Terraform + Supabase „ÅÆ„Åø

```
‚úÖ Supabase„É™„ÇΩ„Éº„Çπ„ÅÆ„ÅøTerraform„ÅßÁÆ°ÁêÜ
‚úÖ „Ç≥„É≥„ÉÜ„Éä„ÅØÊâãÂãï„Éá„Éó„É≠„Ç§ÔºàVercel„ÄÅCloud Run„Å™„Å©Ôºâ
‚úÖ ËªΩÈáè„Å™„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
```

**Êé®ÂÆö„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊôÇÈñì**: 6-8ÊôÇÈñì
**ÊúàÈ°ç„Ç≥„Çπ„Éà**: Supabase Pro $25 + Vercel $0 = **$25/Êúà**

### Option C: ÊâãÂãïÁÆ°ÁêÜÔºàÁèæÁä∂Á∂≠ÊåÅÔºâ

```
‚ö†Ô∏è GUI„Åß„ÅÆÊâãÂãïË®≠ÂÆö
‚ö†Ô∏è „Éâ„Ç≠„É•„É°„É≥„ÉàÂåñ„ÅåÂøÖË¶Å
‚ö†Ô∏è Áí∞Â¢É„ÅÆÂÜçÁèæ„ÅåÂõ∞Èõ£
```

**Êé®ÂÆö„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊôÇÈñì**: 4-6ÊôÇÈñìÔºàÂàùÂõû„ÅÆ„ÅøÔºâ
**ÊúàÈ°ç„Ç≥„Çπ„Éà**: Supabase Pro $25 = **$25/Êúà**

---

## 10. ÂÆüË£Ö„Çø„Çπ„ÇØ„É™„Çπ„Éà

### Phase 1: TerraformÂü∫Áõ§ÊßãÁØâÔºà4-6ÊôÇÈñìÔºâ
- [ ] Terraform„Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÊàê‰ΩúÊàê
- [ ] „Éó„É≠„Éê„Ç§„ÉÄ„ÉºË®≠ÂÆö
- [ ] S3„Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâË®≠ÂÆöÔºàÁä∂ÊÖãÁÆ°ÁêÜÔºâ
- [ ] DynamoDB „ÉÜ„Éº„Éñ„É´‰ΩúÊàêÔºà„É≠„ÉÉ„ÇØÁÆ°ÁêÜÔºâ
- [ ] Âü∫Êú¨„É¢„Ç∏„É•„Éº„É´‰ΩúÊàê

### Phase 2: Supabase„É¢„Ç∏„É•„Éº„É´Ôºà3-4ÊôÇÈñìÔºâ
- [ ] Supabase„Éó„É≠„Éê„Ç§„ÉÄ„ÉºË®≠ÂÆö
- [ ] „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû„ÅÆTerraformÂåñ
- [ ] Storage „Éê„Ç±„ÉÉ„Éà„ÅÆTerraformÂåñ
- [ ] RLS„Éù„É™„Ç∑„Éº„ÅÆTerraformÂåñ
- [ ] „ÉÜ„Çπ„ÉàÂÆüË°å

### Phase 3: AWS„É¢„Ç∏„É•„Éº„É´Ôºà6-8ÊôÇÈñìÔºâ
- [ ] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„É¢„Ç∏„É•„Éº„É´ÔºàVPC„ÄÅSubnetÔºâ
- [ ] ECS„É¢„Ç∏„É•„Éº„É´ÔºàCluster„ÄÅTask„ÄÅServiceÔºâ
- [ ] ALB„É¢„Ç∏„É•„Éº„É´ÔºàLoad BalancerÔºâ
- [ ] IAM„É≠„Éº„É´„Éª„Éù„É™„Ç∑„Éº
- [ ] CloudWatch „É≠„Ç∞Ë®≠ÂÆö

### Phase 4: Áí∞Â¢ÉÂà•Ë®≠ÂÆöÔºà2-3ÊôÇÈñìÔºâ
- [ ] devÁí∞Â¢ÉË®≠ÂÆö
- [ ] stagingÁí∞Â¢ÉË®≠ÂÆö
- [ ] prodÁí∞Â¢ÉË®≠ÂÆö
- [ ] Áí∞Â¢ÉÂ§âÊï∞ÁÆ°ÁêÜÔºàtfvarsÔºâ

### Phase 5: CI/CDÁµ±ÂêàÔºà2-3ÊôÇÈñìÔºâ
- [ ] GitHub Actions „ÉØ„Éº„ÇØ„Éï„É≠„Éº‰ΩúÊàê
- [ ] terraform plan „ÅÆËá™ÂãïÂÆüË°å
- [ ] terraform apply „ÅÆÊâøË™ç„Éï„É≠„Éº
- [ ] SlackÈÄöÁü•Áµ±Âêà

### Phase 6: „Éâ„Ç≠„É•„É°„É≥„ÉàÔºà1-2ÊôÇÈñìÔºâ
- [ ] TerraformÈÅãÁî®„Ç¨„Ç§„Éâ‰ΩúÊàê
- [ ] „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¨„Ç§„Éâ
- [ ] „ÉÅ„Éº„É†Âêë„Åë„ÅÆREADME

**Êé®ÂÆöÂêàË®àÊôÇÈñì**: 18-26ÊôÇÈñì

---

## 11. ÁµêË´ñ

### Terraform„Çí‰Ωø„ÅÜ„Åπ„ÅçÂ†¥Âêà ‚úÖ

- ‚úÖ Ë§áÊï∞Áí∞Â¢É„ÇíÁÆ°ÁêÜ„Åô„ÇãÔºàdev/staging/prodÔºâ
- ‚úÖ „ÉÅ„Éº„É†„ÅßÈñãÁô∫„Åó„Å¶„ÅÑ„Çã
- ‚úÖ „Ç§„É≥„Éï„É©„ÅÆÂ§âÊõ¥„ÅåÈ†ªÁπÅ„Å´„ÅÇ„Çã
- ‚úÖ Áí∞Â¢É„ÅÆÂÜçÁèæÊÄß„ÇíÈáçË¶ñ
- ‚úÖ Èï∑ÊúüÈÅãÁî®„ÇíË¶ãÊçÆ„Åà„Å¶„ÅÑ„Çã

### ÊâãÂãïÁÆ°ÁêÜ„ÇíÁ∂ö„Åë„Çã„Åπ„ÅçÂ†¥Âêà ‚ö†Ô∏è

- ‚ö†Ô∏è Âçò‰∏ÄÁí∞Â¢É„ÅÆ„ÅøÔºàprod„ÅÆ„ÅøÔºâ
- ‚ö†Ô∏è ÂÄã‰∫∫„Éó„É≠„Ç∏„Çß„ÇØ„Éà
- ‚ö†Ô∏è „Ç§„É≥„Éï„É©„Åå„Åª„Å®„Çì„Å©Â§â„Çè„Çâ„Å™„ÅÑ
- ‚ö†Ô∏è ÂàùÊúüÊäïË≥á„ÅÆÊôÇÈñì„Åå„Å™„ÅÑ
- ‚ö†Ô∏è Terraform„ÅÆÂ≠¶ÁøíÊôÇÈñì„ÅåÂèñ„Çå„Å™„ÅÑ

---

## 12. Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó

### Êé®Â•®„Ç¢„Éó„É≠„Éº„ÉÅ

**ÊÆµÈöéÁöÑ„Å™Â∞éÂÖ•„ÇíÊé®Â•®**:

1. **Phase 1**: Supabase„É™„ÇΩ„Éº„Çπ„ÅÆ„Åø TerraformÂåñÔºà6-8ÊôÇÈñìÔºâ
   - „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû
   - Storage „Éê„Ç±„ÉÉ„Éà
   - RLS„Éù„É™„Ç∑„Éº

2. **Phase 2**: AWS ECS„ÇíTerraformÂåñÔºà10-12ÊôÇÈñìÔºâ
   - VPC„Éª„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ
   - ECSÊßãÊàê
   - ALB

3. **Phase 3**: CI/CDÁµ±ÂêàÔºà2-3ÊôÇÈñìÔºâ
   - GitHub Actions
   - Ëá™Âãï„Éá„Éó„É≠„Ç§

**ÂêàË®à**: 18-23ÊôÇÈñì„ÅßÂÆåÂÖ®„Å™Infrastructure as Code„ÅåÂÆåÊàê

---

## 13. ÂÆüË£ÖÈñãÂßãÂà§Êñ≠

### A: TerraformÂ∞éÂÖ•„ÇíÊé®Â•®

‰ª•‰∏ã„ÅÆÊù°‰ª∂„Å´1„Å§„Åß„ÇÇÂΩì„Å¶„ÅØ„Åæ„ÇãÂ†¥Âêà:
- [ ] Ë§áÊï∞Áí∞Â¢ÉÔºàdev/staging/prodÔºâ„ÇíÈÅãÁî®„Åô„Çã
- [ ] „ÉÅ„Éº„É†„É°„É≥„Éê„Éº„Åå2‰∫∫‰ª•‰∏ä
- [ ] „Ç§„É≥„Éï„É©„ÅÆÂ§âÊõ¥„ÅåÊúà1Âõû‰ª•‰∏ä„ÅÇ„Çã
- [ ] Èï∑ÊúüÈÅãÁî®‰∫àÂÆöÔºà6„É∂Êúà‰ª•‰∏äÔºâ

### B: ÁèæÁä∂Á∂≠ÊåÅ„ÇíÊé®Â•®

‰ª•‰∏ã„ÅÆÊù°‰ª∂„Å´ÂÖ®„Å¶ÂΩì„Å¶„ÅØ„Åæ„ÇãÂ†¥Âêà:
- [ ] Âçò‰∏ÄÁí∞Â¢É„ÅÆ„Åø
- [ ] ÂÄã‰∫∫„Éó„É≠„Ç∏„Çß„ÇØ„Éà
- [ ] „Ç§„É≥„Éï„É©„Åå„Åª„ÅºÂõ∫ÂÆö
- [ ] Áü≠Êúü„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÔºà3„É∂Êúà‰ª•ÂÜÖÔºâ

---

**TerraformÂ∞éÂÖ•„ÇíÈñãÂßã„Åó„Åæ„Åô„ÅãÔºü**
